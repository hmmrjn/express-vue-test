'use strict';

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var xss = require('xss');

var PropClass = function PropClass(prop) {
    _classCallCheck(this, PropClass);

    prop.required ? this.required = prop.required : null;
    prop.default ? this.default = prop.default : null;
};

function isLastElement(script, currentElement) {
    var elementArray = Object.keys(script);
    var lastElement = elementArray[elementArray.length - 1];

    if (currentElement === lastElement) {
        return '';
    } else {
        return ',';
    }
}

function routesToString(routes) {
    var routeString = '';
    var lastRoute = routes[routes.length - 1];
    routes.forEach(function (route) {
        if (route !== lastRoute) {
            routeString += scriptToString(route) + ',';
        } else {
            routeString += scriptToString(route);
        }
    });
    return '[' + routeString + ']';
}

function routeComponentsToString(script) {
    var componentString = '';
    for (var member in script) {
        componentString += member + ': __' + script[member] + isLastElement(script, member);
    }
    return '{' + componentString + '}';
}

function mixinsToString(mixins) {
    var mixinString = '';
    var _iteratorNormalCompletion = true;
    var _didIteratorError = false;
    var _iteratorError = undefined;

    try {
        for (var _iterator = mixins[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var mixin = _step.value;

            mixinString += scriptToString(mixin) + ',';
        }
    } catch (err) {
        _didIteratorError = true;
        _iteratorError = err;
    } finally {
        try {
            if (!_iteratorNormalCompletion && _iterator.return) {
                _iterator.return();
            }
        } finally {
            if (_didIteratorError) {
                throw _iteratorError;
            }
        }
    }

    return mixinString;
}

function propsToString(props) {
    var propString = '';
    if (props[Object.keys(props)[0]].type === null) {
        var propsArray = Object.keys(props);
        propString = xss(JSON.stringify(propsArray));
    } else {
        var tempProp = {};
        for (var prop in props) {
            if (props.hasOwnProperty(prop)) {
                var element = new PropClass(props[prop]);
                tempProp[prop] = element;
            }
        }
        propString = scriptToString(tempProp);
    }
    return propString;
}

function scriptToString(script) {
    var scriptString = '';
    for (var member in script) {
        switch (_typeof(script[member])) {
            case 'function':
                if (member === 'data') {
                    var dataObj = xss(JSON.stringify(script[member]()));
                    scriptString += member + ': function(){return ' + dataObj + '},';
                } else {
                    scriptString += member + ': ' + String(script[member]) + isLastElement(script, member);
                }
                break;
            case 'object':
                if (member === 'data') {
                    scriptString += member + ': ' + xss(JSON.stringify(script[member])) + isLastElement(script, member);
                } else if (member === 'routes' || member === 'children') {
                    scriptString += member + ': ' + routesToString(script[member]) + isLastElement(script, member);
                } else if (member === 'components' && script['path'] !== undefined) {
                    // Checks if 'components' is in a route object
                    scriptString += member + ': ' + routeComponentsToString(script[member]) + isLastElement(script, member);
                } else if (member === 'mixins') {
                    scriptString += member + ': [' + mixinsToString(script[member]) + '],';
                } else if (script[member].constructor === Array) {
                    scriptString += member + ': ' + xss(JSON.stringify(script[member])) + isLastElement(script, member);
                } else if (member === 'props') {
                    if (script[member][Object.keys(script[member])[0]].type === null) {
                        var propsArray = Object.keys(script[member]);
                        scriptString += member + ': ' + xss(JSON.stringify(propsArray)) + isLastElement(script, member);
                    } else {
                        // scriptString += member + ': ' + scriptToString(script[member]) + isLastElement(script, member);
                        var propsString = propsToString(script[member]);
                        scriptString += member + ': ' + propsString + ',';
                    }
                } else {
                    scriptString += member + ': ' + scriptToString(script[member]) + isLastElement(script, member);
                }
                break;
            default:
                if (member === 'component' && script['path'] !== undefined) {
                    // Checks if 'component' is in a route object
                    scriptString += member + ': __' + script[member] + isLastElement(script, member);
                } else {
                    scriptString += member + ': ' + JSON.stringify(script[member]) + isLastElement(script, member);
                }
                break;
        }
    }
    var finalScriptString = '{' + scriptString + '}';
    return finalScriptString;
}

module.exports.scriptToString = scriptToString;
module.exports.mixinsToString = mixinsToString;
module.exports.routesToString = routesToString;
module.exports.routeComponentsToString = routeComponentsToString;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlscy9zdHJpbmcuanMiXSwibmFtZXMiOlsieHNzIiwicmVxdWlyZSIsIlByb3BDbGFzcyIsInByb3AiLCJyZXF1aXJlZCIsImRlZmF1bHQiLCJpc0xhc3RFbGVtZW50Iiwic2NyaXB0IiwiY3VycmVudEVsZW1lbnQiLCJlbGVtZW50QXJyYXkiLCJPYmplY3QiLCJrZXlzIiwibGFzdEVsZW1lbnQiLCJsZW5ndGgiLCJyb3V0ZXNUb1N0cmluZyIsInJvdXRlcyIsInJvdXRlU3RyaW5nIiwibGFzdFJvdXRlIiwiZm9yRWFjaCIsInJvdXRlIiwic2NyaXB0VG9TdHJpbmciLCJyb3V0ZUNvbXBvbmVudHNUb1N0cmluZyIsImNvbXBvbmVudFN0cmluZyIsIm1lbWJlciIsIm1peGluc1RvU3RyaW5nIiwibWl4aW5zIiwibWl4aW5TdHJpbmciLCJtaXhpbiIsInByb3BzVG9TdHJpbmciLCJwcm9wcyIsInByb3BTdHJpbmciLCJ0eXBlIiwicHJvcHNBcnJheSIsIkpTT04iLCJzdHJpbmdpZnkiLCJ0ZW1wUHJvcCIsImhhc093blByb3BlcnR5IiwiZWxlbWVudCIsInNjcmlwdFN0cmluZyIsImRhdGFPYmoiLCJTdHJpbmciLCJ1bmRlZmluZWQiLCJjb25zdHJ1Y3RvciIsIkFycmF5IiwicHJvcHNTdHJpbmciLCJmaW5hbFNjcmlwdFN0cmluZyIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUNBLElBQU1BLE1BQU1DLFFBQVEsS0FBUixDQUFaOztJQUVNQyxTLEdBSUYsbUJBQVlDLElBQVosRUFBdUI7QUFBQTs7QUFDbkJBLFNBQUtDLFFBQUwsR0FBZ0IsS0FBS0EsUUFBTCxHQUFnQkQsS0FBS0MsUUFBckMsR0FBZ0QsSUFBaEQ7QUFDQUQsU0FBS0UsT0FBTCxHQUFlLEtBQUtBLE9BQUwsR0FBZUYsS0FBS0UsT0FBbkMsR0FBNkMsSUFBN0M7QUFDSCxDOztBQUdMLFNBQVNDLGFBQVQsQ0FBdUJDLE1BQXZCLEVBQTZDQyxjQUE3QyxFQUE2RTtBQUN6RSxRQUFNQyxlQUFlQyxPQUFPQyxJQUFQLENBQVlKLE1BQVosQ0FBckI7QUFDQSxRQUFNSyxjQUFjSCxhQUFhQSxhQUFhSSxNQUFiLEdBQXNCLENBQW5DLENBQXBCOztBQUVBLFFBQUlMLG1CQUFtQkksV0FBdkIsRUFBb0M7QUFDaEMsZUFBTyxFQUFQO0FBQ0gsS0FGRCxNQUVPO0FBQ0gsZUFBTyxHQUFQO0FBQ0g7QUFDSjs7QUFFRCxTQUFTRSxjQUFULENBQXdCQyxNQUF4QixFQUFrRDtBQUM5QyxRQUFJQyxjQUFjLEVBQWxCO0FBQ0EsUUFBTUMsWUFBWUYsT0FBT0EsT0FBT0YsTUFBUCxHQUFjLENBQXJCLENBQWxCO0FBQ0FFLFdBQU9HLE9BQVAsQ0FBZSxpQkFBUztBQUNwQixZQUFJQyxVQUFVRixTQUFkLEVBQXlCO0FBQ3JCRCwyQkFBZUksZUFBZUQsS0FBZixJQUF3QixHQUF2QztBQUNILFNBRkQsTUFFTztBQUNISCwyQkFBZUksZUFBZUQsS0FBZixDQUFmO0FBQ0g7QUFDSixLQU5EO0FBT0EsaUJBQVdILFdBQVg7QUFDSDs7QUFFRCxTQUFTSyx1QkFBVCxDQUFpQ2QsTUFBakMsRUFBeUQ7QUFDckQsUUFBSWUsa0JBQWtCLEVBQXRCO0FBQ0EsU0FBSyxJQUFJQyxNQUFULElBQW1CaEIsTUFBbkIsRUFBMkI7QUFDdkJlLDJCQUFtQkMsU0FBUyxNQUFULEdBQWtCaEIsT0FBT2dCLE1BQVAsQ0FBbEIsR0FBbUNqQixjQUFjQyxNQUFkLEVBQXNCZ0IsTUFBdEIsQ0FBdEQ7QUFDSDtBQUNELGlCQUFXRCxlQUFYO0FBQ0g7O0FBRUQsU0FBU0UsY0FBVCxDQUF3QkMsTUFBeEIsRUFBMkQ7QUFDdkQsUUFBSUMsY0FBYyxFQUFsQjtBQUR1RDtBQUFBO0FBQUE7O0FBQUE7QUFFdkQsNkJBQWtCRCxNQUFsQiw4SEFBMEI7QUFBQSxnQkFBakJFLEtBQWlCOztBQUN0QkQsMkJBQWtCTixlQUFlTyxLQUFmLENBQWxCO0FBQ0g7QUFKc0Q7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUFLdkQsV0FBT0QsV0FBUDtBQUNIOztBQUVELFNBQVNFLGFBQVQsQ0FBdUJDLEtBQXZCLEVBQThDO0FBQzFDLFFBQUlDLGFBQWEsRUFBakI7QUFDQSxRQUFJRCxNQUFNbkIsT0FBT0MsSUFBUCxDQUFZa0IsS0FBWixFQUFtQixDQUFuQixDQUFOLEVBQTZCRSxJQUE3QixLQUFzQyxJQUExQyxFQUFnRDtBQUM1QyxZQUFJQyxhQUFhdEIsT0FBT0MsSUFBUCxDQUFZa0IsS0FBWixDQUFqQjtBQUNBQyxxQkFBYTlCLElBQUlpQyxLQUFLQyxTQUFMLENBQWVGLFVBQWYsQ0FBSixDQUFiO0FBQ0gsS0FIRCxNQUdPO0FBQ0gsWUFBSUcsV0FBVyxFQUFmO0FBQ0EsYUFBSyxJQUFJaEMsSUFBVCxJQUFpQjBCLEtBQWpCLEVBQXdCO0FBQ3BCLGdCQUFJQSxNQUFNTyxjQUFOLENBQXFCakMsSUFBckIsQ0FBSixFQUFnQztBQUM1QixvQkFBSWtDLFVBQVUsSUFBSW5DLFNBQUosQ0FBYzJCLE1BQU0xQixJQUFOLENBQWQsQ0FBZDtBQUNBZ0MseUJBQVNoQyxJQUFULElBQWlCa0MsT0FBakI7QUFDSDtBQUNKO0FBQ0RQLHFCQUFhVixlQUFlZSxRQUFmLENBQWI7QUFDSDtBQUNELFdBQU9MLFVBQVA7QUFDSDs7QUFFRCxTQUFTVixjQUFULENBQXdCYixNQUF4QixFQUFzRDtBQUNsRCxRQUFJK0IsZUFBZSxFQUFuQjtBQUNBLFNBQUssSUFBSWYsTUFBVCxJQUFtQmhCLE1BQW5CLEVBQTJCO0FBQ3ZCLHdCQUFlQSxPQUFPZ0IsTUFBUCxDQUFmO0FBQ0ksaUJBQUssVUFBTDtBQUNJLG9CQUFJQSxXQUFXLE1BQWYsRUFBdUI7QUFDbkIsd0JBQU1nQixVQUFVdkMsSUFBSWlDLEtBQUtDLFNBQUwsQ0FBZTNCLE9BQU9nQixNQUFQLEdBQWYsQ0FBSixDQUFoQjtBQUNBZSxvQ0FBbUJmLE1BQW5CLDRCQUFnRGdCLE9BQWhEO0FBQ0gsaUJBSEQsTUFHTztBQUNIRCxvQ0FBZ0JmLFNBQVMsSUFBVCxHQUFnQmlCLE9BQU9qQyxPQUFPZ0IsTUFBUCxDQUFQLENBQWhCLEdBQXlDakIsY0FBY0MsTUFBZCxFQUFzQmdCLE1BQXRCLENBQXpEO0FBQ0g7QUFDRDtBQUNKLGlCQUFLLFFBQUw7QUFDSSxvQkFBSUEsV0FBVyxNQUFmLEVBQXVCO0FBQ25CZSxvQ0FBZ0JmLFNBQVMsSUFBVCxHQUFnQnZCLElBQUlpQyxLQUFLQyxTQUFMLENBQWUzQixPQUFPZ0IsTUFBUCxDQUFmLENBQUosQ0FBaEIsR0FBc0RqQixjQUFjQyxNQUFkLEVBQXNCZ0IsTUFBdEIsQ0FBdEU7QUFDSCxpQkFGRCxNQUVPLElBQUlBLFdBQVcsUUFBWCxJQUF1QkEsV0FBVyxVQUF0QyxFQUFrRDtBQUNyRGUsb0NBQWdCZixTQUFTLElBQVQsR0FBZ0JULGVBQWVQLE9BQU9nQixNQUFQLENBQWYsQ0FBaEIsR0FBaURqQixjQUFjQyxNQUFkLEVBQXNCZ0IsTUFBdEIsQ0FBakU7QUFDSCxpQkFGTSxNQUVBLElBQUlBLFdBQVcsWUFBWCxJQUEyQmhCLE9BQU8sTUFBUCxNQUFtQmtDLFNBQWxELEVBQTZEO0FBQUU7QUFDbEVILG9DQUFnQmYsU0FBUyxJQUFULEdBQWdCRix3QkFBd0JkLE9BQU9nQixNQUFQLENBQXhCLENBQWhCLEdBQTBEakIsY0FBY0MsTUFBZCxFQUFzQmdCLE1BQXRCLENBQTFFO0FBQ0gsaUJBRk0sTUFFQSxJQUFJQSxXQUFXLFFBQWYsRUFBeUI7QUFDNUJlLG9DQUFnQmYsU0FBUyxLQUFULEdBQWlCQyxlQUFlakIsT0FBT2dCLE1BQVAsQ0FBZixDQUFqQixHQUFrRCxJQUFsRTtBQUNILGlCQUZNLE1BRUEsSUFBSWhCLE9BQU9nQixNQUFQLEVBQWVtQixXQUFmLEtBQStCQyxLQUFuQyxFQUEwQztBQUM3Q0wsb0NBQWdCZixTQUFTLElBQVQsR0FBZ0J2QixJQUFJaUMsS0FBS0MsU0FBTCxDQUFlM0IsT0FBT2dCLE1BQVAsQ0FBZixDQUFKLENBQWhCLEdBQXNEakIsY0FBY0MsTUFBZCxFQUFzQmdCLE1BQXRCLENBQXRFO0FBQ0gsaUJBRk0sTUFFQSxJQUFJQSxXQUFXLE9BQWYsRUFBd0I7QUFDM0Isd0JBQUloQixPQUFPZ0IsTUFBUCxFQUFlYixPQUFPQyxJQUFQLENBQVlKLE9BQU9nQixNQUFQLENBQVosRUFBNEIsQ0FBNUIsQ0FBZixFQUErQ1EsSUFBL0MsS0FBd0QsSUFBNUQsRUFBa0U7QUFDOUQsNEJBQUlDLGFBQWF0QixPQUFPQyxJQUFQLENBQVlKLE9BQU9nQixNQUFQLENBQVosQ0FBakI7QUFDQWUsd0NBQWdCZixTQUFTLElBQVQsR0FBZ0J2QixJQUFJaUMsS0FBS0MsU0FBTCxDQUFlRixVQUFmLENBQUosQ0FBaEIsR0FBa0QxQixjQUFjQyxNQUFkLEVBQXNCZ0IsTUFBdEIsQ0FBbEU7QUFDSCxxQkFIRCxNQUdPO0FBQ0g7QUFDQSw0QkFBTXFCLGNBQWNoQixjQUFjckIsT0FBT2dCLE1BQVAsQ0FBZCxDQUFwQjtBQUNBZSx3Q0FBbUJmLE1BQW5CLFVBQThCcUIsV0FBOUI7QUFDSDtBQUVKLGlCQVZNLE1BVUE7QUFDSE4sb0NBQWdCZixTQUFTLElBQVQsR0FBZ0JILGVBQWViLE9BQU9nQixNQUFQLENBQWYsQ0FBaEIsR0FBaURqQixjQUFjQyxNQUFkLEVBQXNCZ0IsTUFBdEIsQ0FBakU7QUFDSDtBQUNEO0FBQ0o7QUFDSSxvQkFBSUEsV0FBVyxXQUFYLElBQTBCaEIsT0FBTyxNQUFQLE1BQW1Ca0MsU0FBakQsRUFBNEQ7QUFBRTtBQUMxREgsb0NBQWdCZixTQUFTLE1BQVQsR0FBa0JoQixPQUFPZ0IsTUFBUCxDQUFsQixHQUFtQ2pCLGNBQWNDLE1BQWQsRUFBc0JnQixNQUF0QixDQUFuRDtBQUNILGlCQUZELE1BRU87QUFDSGUsb0NBQWdCZixTQUFTLElBQVQsR0FBZ0JVLEtBQUtDLFNBQUwsQ0FBZTNCLE9BQU9nQixNQUFQLENBQWYsQ0FBaEIsR0FBaURqQixjQUFjQyxNQUFkLEVBQXNCZ0IsTUFBdEIsQ0FBakU7QUFDSDtBQUNEO0FBeENSO0FBMENIO0FBQ0QsUUFBSXNCLDBCQUF3QlAsWUFBeEIsTUFBSjtBQUNBLFdBQU9PLGlCQUFQO0FBQ0g7O0FBRURDLE9BQU9DLE9BQVAsQ0FBZTNCLGNBQWYsR0FBZ0NBLGNBQWhDO0FBQ0EwQixPQUFPQyxPQUFQLENBQWV2QixjQUFmLEdBQWdDQSxjQUFoQztBQUNBc0IsT0FBT0MsT0FBUCxDQUFlakMsY0FBZixHQUFnQ0EsY0FBaEM7QUFDQWdDLE9BQU9DLE9BQVAsQ0FBZTFCLHVCQUFmLEdBQXlDQSx1QkFBekMiLCJmaWxlIjoic3RyaW5nLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQGZsb3dcbmNvbnN0IHhzcyA9IHJlcXVpcmUoJ3hzcycpO1xuXG5jbGFzcyBQcm9wQ2xhc3Mge1xuICAgIHR5cGU6IGFueTtcbiAgICByZXF1aXJlZDogYm9vbGVhbjtcbiAgICBkZWZhdWx0OiBhbnk7XG4gICAgY29uc3RydWN0b3IocHJvcDogYW55KSB7XG4gICAgICAgIHByb3AucmVxdWlyZWQgPyB0aGlzLnJlcXVpcmVkID0gcHJvcC5yZXF1aXJlZCA6IG51bGw7XG4gICAgICAgIHByb3AuZGVmYXVsdCA/IHRoaXMuZGVmYXVsdCA9IHByb3AuZGVmYXVsdCA6IG51bGw7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBpc0xhc3RFbGVtZW50KHNjcmlwdDogT2JqZWN0IHwgYW55LCBjdXJyZW50RWxlbWVudDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBjb25zdCBlbGVtZW50QXJyYXkgPSBPYmplY3Qua2V5cyhzY3JpcHQpO1xuICAgIGNvbnN0IGxhc3RFbGVtZW50ID0gZWxlbWVudEFycmF5W2VsZW1lbnRBcnJheS5sZW5ndGggLSAxXTtcblxuICAgIGlmIChjdXJyZW50RWxlbWVudCA9PT0gbGFzdEVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuICcnO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiAnLCc7XG4gICAgfVxufVxuXG5mdW5jdGlvbiByb3V0ZXNUb1N0cmluZyhyb3V0ZXM6IE9iamVjdFtdKTogc3RyaW5nIHtcbiAgICBsZXQgcm91dGVTdHJpbmcgPSAnJztcbiAgICBjb25zdCBsYXN0Um91dGUgPSByb3V0ZXNbcm91dGVzLmxlbmd0aC0xXTtcbiAgICByb3V0ZXMuZm9yRWFjaChyb3V0ZSA9PiB7XG4gICAgICAgIGlmIChyb3V0ZSAhPT0gbGFzdFJvdXRlKSB7XG4gICAgICAgICAgICByb3V0ZVN0cmluZyArPSBzY3JpcHRUb1N0cmluZyhyb3V0ZSkgKyAnLCc7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByb3V0ZVN0cmluZyArPSBzY3JpcHRUb1N0cmluZyhyb3V0ZSk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gYFske3JvdXRlU3RyaW5nfV1gO1xufVxuXG5mdW5jdGlvbiByb3V0ZUNvbXBvbmVudHNUb1N0cmluZyhzY3JpcHQ6IE9iamVjdCk6IHN0cmluZyB7XG4gICAgbGV0IGNvbXBvbmVudFN0cmluZyA9ICcnO1xuICAgIGZvciAobGV0IG1lbWJlciBpbiBzY3JpcHQpIHtcbiAgICAgICAgY29tcG9uZW50U3RyaW5nICs9IG1lbWJlciArICc6IF9fJyArIHNjcmlwdFttZW1iZXJdICsgaXNMYXN0RWxlbWVudChzY3JpcHQsIG1lbWJlcik7XG4gICAgfVxuICAgIHJldHVybiBgeyR7Y29tcG9uZW50U3RyaW5nfX1gO1xufVxuXG5mdW5jdGlvbiBtaXhpbnNUb1N0cmluZyhtaXhpbnM6IEFycmF5IDwgT2JqZWN0ID4gKTogc3RyaW5nIHtcbiAgICB2YXIgbWl4aW5TdHJpbmcgPSAnJztcbiAgICBmb3IgKHZhciBtaXhpbiBvZiBtaXhpbnMpIHtcbiAgICAgICAgbWl4aW5TdHJpbmcgKz0gYCR7c2NyaXB0VG9TdHJpbmcobWl4aW4pfSxgO1xuICAgIH1cbiAgICByZXR1cm4gbWl4aW5TdHJpbmc7XG59XG5cbmZ1bmN0aW9uIHByb3BzVG9TdHJpbmcocHJvcHM6IE9iamVjdCk6IHN0cmluZyB7XG4gICAgbGV0IHByb3BTdHJpbmcgPSAnJztcbiAgICBpZiAocHJvcHNbT2JqZWN0LmtleXMocHJvcHMpWzBdXS50eXBlID09PSBudWxsKSB7XG4gICAgICAgIHZhciBwcm9wc0FycmF5ID0gT2JqZWN0LmtleXMocHJvcHMpO1xuICAgICAgICBwcm9wU3RyaW5nID0geHNzKEpTT04uc3RyaW5naWZ5KHByb3BzQXJyYXkpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBsZXQgdGVtcFByb3AgPSB7fTtcbiAgICAgICAgZm9yICh2YXIgcHJvcCBpbiBwcm9wcykge1xuICAgICAgICAgICAgaWYgKHByb3BzLmhhc093blByb3BlcnR5KHByb3ApKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBuZXcgUHJvcENsYXNzKHByb3BzW3Byb3BdKTtcbiAgICAgICAgICAgICAgICB0ZW1wUHJvcFtwcm9wXSA9IGVsZW1lbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcHJvcFN0cmluZyA9IHNjcmlwdFRvU3RyaW5nKHRlbXBQcm9wKTtcbiAgICB9XG4gICAgcmV0dXJuIHByb3BTdHJpbmc7XG59XG5cbmZ1bmN0aW9uIHNjcmlwdFRvU3RyaW5nKHNjcmlwdDogT2JqZWN0IHwgYW55KTogc3RyaW5nIHtcbiAgICBsZXQgc2NyaXB0U3RyaW5nID0gJyc7XG4gICAgZm9yIChsZXQgbWVtYmVyIGluIHNjcmlwdCkge1xuICAgICAgICBzd2l0Y2ggKHR5cGVvZiBzY3JpcHRbbWVtYmVyXSkge1xuICAgICAgICAgICAgY2FzZSAnZnVuY3Rpb24nOlxuICAgICAgICAgICAgICAgIGlmIChtZW1iZXIgPT09ICdkYXRhJykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhT2JqID0geHNzKEpTT04uc3RyaW5naWZ5KHNjcmlwdFttZW1iZXJdKCkpKTtcbiAgICAgICAgICAgICAgICAgICAgc2NyaXB0U3RyaW5nICs9IGAke21lbWJlcn06IGZ1bmN0aW9uKCl7cmV0dXJuICR7ZGF0YU9ian19LGA7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc2NyaXB0U3RyaW5nICs9IG1lbWJlciArICc6ICcgKyBTdHJpbmcoc2NyaXB0W21lbWJlcl0pICsgaXNMYXN0RWxlbWVudChzY3JpcHQsIG1lbWJlcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICBpZiAobWVtYmVyID09PSAnZGF0YScpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NyaXB0U3RyaW5nICs9IG1lbWJlciArICc6ICcgKyB4c3MoSlNPTi5zdHJpbmdpZnkoc2NyaXB0W21lbWJlcl0pKSArIGlzTGFzdEVsZW1lbnQoc2NyaXB0LCBtZW1iZXIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWVtYmVyID09PSAncm91dGVzJyB8fCBtZW1iZXIgPT09ICdjaGlsZHJlbicpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NyaXB0U3RyaW5nICs9IG1lbWJlciArICc6ICcgKyByb3V0ZXNUb1N0cmluZyhzY3JpcHRbbWVtYmVyXSkgKyBpc0xhc3RFbGVtZW50KHNjcmlwdCwgbWVtYmVyKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1lbWJlciA9PT0gJ2NvbXBvbmVudHMnICYmIHNjcmlwdFsncGF0aCddICE9PSB1bmRlZmluZWQpIHsgLy8gQ2hlY2tzIGlmICdjb21wb25lbnRzJyBpcyBpbiBhIHJvdXRlIG9iamVjdFxuICAgICAgICAgICAgICAgICAgICBzY3JpcHRTdHJpbmcgKz0gbWVtYmVyICsgJzogJyArIHJvdXRlQ29tcG9uZW50c1RvU3RyaW5nKHNjcmlwdFttZW1iZXJdKSArIGlzTGFzdEVsZW1lbnQoc2NyaXB0LCBtZW1iZXIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWVtYmVyID09PSAnbWl4aW5zJykge1xuICAgICAgICAgICAgICAgICAgICBzY3JpcHRTdHJpbmcgKz0gbWVtYmVyICsgJzogWycgKyBtaXhpbnNUb1N0cmluZyhzY3JpcHRbbWVtYmVyXSkgKyAnXSwnO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2NyaXB0W21lbWJlcl0uY29uc3RydWN0b3IgPT09IEFycmF5KSB7XG4gICAgICAgICAgICAgICAgICAgIHNjcmlwdFN0cmluZyArPSBtZW1iZXIgKyAnOiAnICsgeHNzKEpTT04uc3RyaW5naWZ5KHNjcmlwdFttZW1iZXJdKSkgKyBpc0xhc3RFbGVtZW50KHNjcmlwdCwgbWVtYmVyKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1lbWJlciA9PT0gJ3Byb3BzJykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2NyaXB0W21lbWJlcl1bT2JqZWN0LmtleXMoc2NyaXB0W21lbWJlcl0pWzBdXS50eXBlID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHJvcHNBcnJheSA9IE9iamVjdC5rZXlzKHNjcmlwdFttZW1iZXJdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjcmlwdFN0cmluZyArPSBtZW1iZXIgKyAnOiAnICsgeHNzKEpTT04uc3RyaW5naWZ5KHByb3BzQXJyYXkpKSArIGlzTGFzdEVsZW1lbnQoc2NyaXB0LCBtZW1iZXIpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2NyaXB0U3RyaW5nICs9IG1lbWJlciArICc6ICcgKyBzY3JpcHRUb1N0cmluZyhzY3JpcHRbbWVtYmVyXSkgKyBpc0xhc3RFbGVtZW50KHNjcmlwdCwgbWVtYmVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb3BzU3RyaW5nID0gcHJvcHNUb1N0cmluZyhzY3JpcHRbbWVtYmVyXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY3JpcHRTdHJpbmcgKz0gYCR7bWVtYmVyfTogJHtwcm9wc1N0cmluZ30sYDtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc2NyaXB0U3RyaW5nICs9IG1lbWJlciArICc6ICcgKyBzY3JpcHRUb1N0cmluZyhzY3JpcHRbbWVtYmVyXSkgKyBpc0xhc3RFbGVtZW50KHNjcmlwdCwgbWVtYmVyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGlmIChtZW1iZXIgPT09ICdjb21wb25lbnQnICYmIHNjcmlwdFsncGF0aCddICE9PSB1bmRlZmluZWQpIHsgLy8gQ2hlY2tzIGlmICdjb21wb25lbnQnIGlzIGluIGEgcm91dGUgb2JqZWN0XG4gICAgICAgICAgICAgICAgICAgIHNjcmlwdFN0cmluZyArPSBtZW1iZXIgKyAnOiBfXycgKyBzY3JpcHRbbWVtYmVyXSArIGlzTGFzdEVsZW1lbnQoc2NyaXB0LCBtZW1iZXIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNjcmlwdFN0cmluZyArPSBtZW1iZXIgKyAnOiAnICsgSlNPTi5zdHJpbmdpZnkoc2NyaXB0W21lbWJlcl0pICsgaXNMYXN0RWxlbWVudChzY3JpcHQsIG1lbWJlcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuICAgIGxldCBmaW5hbFNjcmlwdFN0cmluZyA9IGB7JHtzY3JpcHRTdHJpbmd9fWA7XG4gICAgcmV0dXJuIGZpbmFsU2NyaXB0U3RyaW5nO1xufVxuXG5tb2R1bGUuZXhwb3J0cy5zY3JpcHRUb1N0cmluZyA9IHNjcmlwdFRvU3RyaW5nO1xubW9kdWxlLmV4cG9ydHMubWl4aW5zVG9TdHJpbmcgPSBtaXhpbnNUb1N0cmluZztcbm1vZHVsZS5leHBvcnRzLnJvdXRlc1RvU3RyaW5nID0gcm91dGVzVG9TdHJpbmc7XG5tb2R1bGUuZXhwb3J0cy5yb3V0ZUNvbXBvbmVudHNUb1N0cmluZyA9IHJvdXRlQ29tcG9uZW50c1RvU3RyaW5nO1xuIl19